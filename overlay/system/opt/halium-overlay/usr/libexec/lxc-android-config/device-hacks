# Audio hack
mount -o bind /system/lib64/hw/audio.hidl_compat.default.so /vendor/lib64/hw/audio.primary.default.so

# hide fuelgauge and sec-direct-charger
mount -o ro -t tmpfs tmpfs /sys/class/power_supply/max77705-fuelgauge
mount -o ro -t tmpfs tmpfs /sys/class/power_supply/sec-direct-charger

# WiFi: Wait for the property system to be up.
while [ ! -e /dev/socket/property_service ]; do sleep 0.5; done

echo 1 > /sys/kernel/icnss/wpss_boot
sleep 0.2

echo 1 > /dev/wcnss_wlan
sleep 0.2

echo 1 > /dev/wcnss_ctrl
sleep 0.2

while [ ! -e /dev/ipa ]; do sleep 0.2; done
echo 1 > /dev/ipa

# Copy xdg desktop file to enable wlan late
#if [ ! -f /etc/xdg/autostart/wlan.desktop ]; then
#    mount -o remount,rw /
#    cp /opt/halium-overlay/etc/xdg/autostart/wlan.desktop /etc/xdg/autostart/wlan.desktop
#    mount -o remount,ro /
#fi

# While the time_daemon binary has been overlayed by a non-executable, Android
# init will continue trying to restart that service. Stop the cycle by
# explicitly tell it to stop.
setprop ctl.stop time_daemon
